{% extends "base.html" %}
{% load static %}
{% block content %}
    <!-- Main content -->
    <div class="content-wrapper">
    <section class="content">
      <div class="row">
        <!-- /.col -->
          <div id="Accountedit">
            <div class="box">
              <form role="form" name='Rni form' id = 'target-form' method='POST'>
                {% csrf_token %}
                <div class="box-body">
                  <h3 class="box-title">Manage Account Entry</h3>
                  <div class="col-xs-6">  
                    <div class="form-group">
                      <label for="RNI Name">Entry Date</label>
                            <div id="datepicker-popup2" class="input-group date datepicker">
                              <input type="text" class="form-control" id='entry_date' value='{{entry.date|date:"m/d/Y"}}'>
                              <span class="input-group-addon input-group-append border-left">
                                <span class="mdi mdi-calendar input-group-text"></span>
                              </span>
                            </div>
                    </div>
                    <div class="form-group">
                      <label for="Default Time">Truck</label>
                      <input type="text" class="form-control" id="truck" placeholder="truck" data-toggle="modal" data-target="#modal-default" value="{{entry.truck.truck_no}}">
                    </div>
                    <div class="form-group">
                      <label for="RNI Version">Customer Consignee</label>
                      <input type="text" class="form-control" id="consignee" placeholder="Consignee" data-toggle="modal" data-target="#modal-default3" value="{{entry.customer_consignee.customer_name}}">
                      
                    </div>
                    <div class="form-group">
                      <label for="Verifier">Customer Consigner</label>
                      <input type="text" class="form-control" id="consigner" placeholder="Consigner" data-toggle="modal" data-target="#modal-default2" value="{{entry.customer_consigner.customer_name}}">
                    </div>
                     <div class="form-group">
                      <label for="RNI ID">Hamali</label>
                      <input type="text" class="form-control" id="hamali" placeholder="Hamali" value="{{entry.hamali}}">
                    </div> 
                    
                    <div class="form-group">
                      <label for="URL">Net Collection</label>
                      <input type="text" class="form-control" id="net_collection" placeholder="Net collection" value="{{entry.netcollection}}">
                    </div>
            
                    <div class="form-group">
                      <label for="rni_type">Collection Date</label>
                      <!-- <input type="text" class="form-control" id="collection_date" placeholder="Collection Date" value=""> -->
                      <div id="datepicker-popup4" class="input-group date datepicker">
                              <input type="text" class="form-control" id='collection_date' value='{{entry.collection_date|date:"m/d/Y"}}'>
                              <span class="input-group-addon input-group-append border-left">
                                <span class="mdi mdi-calendar input-group-text"></span>
                              </span>
                            </div>
                    </div>
                  </div>
                  <div class="col-xs-6">  
                    <div class="form-group">
                      <label for="RNI ID">Tons</label>
                      <input type="text" class="form-control" id="tons" placeholder="Tons" value="{{entry.tons}}">
                    </div>  
                  
                    <div class="form-group">
                      <label for="NC ID">Freight</label>
                      <input type="text" class="form-control" id="freight" placeholder="Freight" value="{{entry.freight}}">        
                    </div>
                    
                    <div class="form-group">
                      <label for="URL">Advance</label>
                      <input type="text" class="form-control" id="advance" placeholder="Advance" value="{{entry.advance}}">
                    </div>
            
                    <div class="form-group">
                      <label for="rni_type">Balance</label>
                      <input type="text" class="form-control" id="balance" placeholder="Balance" value="{{entry.balance}}">
                    </div>
                    <div class="form-group">
                      <label for="RNI ID">Paid Date</label>
                      <!-- <input type="text" class="form-control" id="paid_date" placeholder="Paid Date" value=""> -->
                      <div id="datepicker-popup3" class="input-group date datepicker">
                              <input type="text" class="form-control" id='paid_date' value='{{entry.paid_date|date:"m/d/Y"}}'>
                              <span class="input-group-addon input-group-append border-left">
                                <span class="mdi mdi-calendar input-group-text"></span>
                              </span>
                            </div>
                    </div>  
                    <div class="form-group">
                      <label for="NC ID">Paid Balance</label>
                      <input type="text" class="form-control" id="paid_balance" placeholder="Paid Balance" value="{{entry.paid_balance}}">
                    </div>
                    
                    <div class="form-group">
                      <label for="URL">Station</label>
                      <input type="text" class="form-control" id="station" placeholder="Station" value="{{entry.station}}">
                    </div>
                  </div>

          </div>
        </form>
        </div>
        </div>
        <!--/.col-->
      </div>
      <!-- /.row -->
    </section>
  </div>
    <div class="modal fade in" id="modal-default">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">×</span></button>
                <h4 class="modal-title">Truck Details</h4>
              </div>
              <div class="modal-body">
                <div class="table-responsive">
                  <table class="table table-bordered table-striped" id="trucktable">
                        <thead>
                        <tr>
                            <th>Truck No</th>
                            <th>Driver Name</th>
                            <th>Owner Name</th>
                            <th>licence_id</th>
                        </tr>
                    </thead>
                   <tbody>
                     {% for lorry in lorries %}
                            <tr value={{lorry}}>
                                <td id = 'truck_no'>{{ lorry.truck_no }}</td>
                                <td>{{ lorry.driver_name }}</td>
                                <td >{{ lorry.owner_name }}</td>
                                <td>{{ lorry.licence_id }}</td>
                            </tr>
                        {% endfor %}
                   </tbody>
                   </table>

                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
              </div>
            </div>
            <!-- /.modal-content -->
          </div>
          <!-- /.modal-dialog -->
        </div>
    <div class="modal fade in" id="modal-default2">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">×</span></button>
                <h4 class="modal-title">Consigner Details</h4>
              </div>
              <div class="modal-body">
                <div class="table-responsive">
                  <table class="table table-bordered table-striped" id="consignertable">
                        <thead>
                        <tr>
                            <th>Customer Name</th>
                            <th>Contact</th>
                        </tr>
                    </thead>
                   <tbody>
                     {% for consigner in consigners %}
                            <tr value={{consigner}}>
                                <td id = 'consigner_p'>{{ consigner.customer_name }}</td>
                                <td>{{ consigner.contact }}</td>
                            </tr>
                        {% endfor %}
                   </tbody>
                   </table>

                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
              </div>
            </div>
            <!-- /.modal-content -->
          </div>
          <!-- /.modal-dialog -->
        </div>
    <div class="modal fade in" id="modal-default3">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">×</span></button>
                <h4 class="modal-title">Consignee Details</h4>
              </div>
              <div class="modal-body">
                <div class="table-responsive">
                  <table class="table table-bordered table-striped" id="consigneetable">
                        <thead>
                        <tr>
                            <th>Customer Name</th>
                            <th>Contact</th>
                        </tr>
                    </thead>
                   <tbody>
                     {% for consignee in consignees %}
                            <tr value={{consigner}}>
                                <td id = 'consignee_p'>{{ consignee.customer_name }}</td>
                                <td>{{ consignee.contact }}</td>
                            </tr>
                        {% endfor %}
                   </tbody>
                   </table>

                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
              </div>
            </div>
            <!-- /.modal-content -->
          </div>
          <!-- /.modal-dialog -->
        </div>
    {% endblock %}    
    {% block script %}    
    <script type="text/javascript">
      $( document ).ready(function() {
            $('#usertable').DataTable({
              'paging'      : true,
              'lengthChange': false,
              'searching'   : true,
              'ordering'    : true,
              'info'        : true,
              'autoWidth'   : false,
            });
            $('#trucktable tbody').on( 'click', 'tr', function () {
                $('#truck').val($(this).find('#truck_no').text());
                $('#modal-default').modal('hide');
            });
            $('#consigneetable tbody').on( 'click', 'tr', function () {
                $('#consignee').val($(this).find('#consignee_p').text());
                $('#modal-default3').modal('hide');
            });
            $('#consignertable tbody').on( 'click', 'tr', function () {
                $('#consigner').val($(this).find('#consigner_p').text());
                $('#modal-default2').modal('hide');
            });
            $( "#datepicker-popup2" ).datepicker( "option", "dateFormat", 'dd.mm.yy' );
            $( "#datepicker-popup3" ).datepicker( "option", "dateFormat", 'dd.mm.yy' );
            $( "#datepicker-popup4" ).datepicker( "option", "dateFormat", 'dd.mm.yy' );
            $("#target-form :input").prop("disabled", true);
              $('#edit').click(function() {
                $("#target-form :input").prop("disabled", false);
              });
              $('#cancel').click(function() {
                $("#target-form :input").prop("disabled", true);
              });
              // $('#edit').trigger('click');
              $('#save').click(function(){
                 var error_msgs = [];
                if($('#entry_date').val() == ""){
                  validate('#entry_date');
                  error_msgs.push('Entry Date is Required');
                }
                if($('#truck').val() == ""){
                    validate('#truck');
                    error_msgs.push('Truck is Required');
                }
                if($('#consignee').val() == ""){
                    validate('#consignee');
                    error_msgs.push('Consignee is Required');   
                }
                if($('#consigner').val() == ""){
                    validate('#consigner');
                    error_msgs.push('Consigner is Required');   
                }
                if (error_msgs.length>0) {
                    var errors = error_msgs.join("<br/>");
                    display_errors(errors)
                }else{
                    $.ajax({
                        url: window.location.href,
                        type: "POST",
                        data: {
                          csrfmiddlewaretoken: getCookie('csrftoken'),
                          entry: $('#entry_date').val(),
                          truck: $('#truck').val(),
                          consignee: $('#consignee').val(),
                          consigner: $('#consigner').val(),
                          tons: $('#tons').val(),
                          freight: $('#freight').val(),
                          advance: $('#advance').val(),
                          balance: $('#balance').val(),
                          hamali: $('#hamali').val(),
                          net_collection: $('#net_collection').val(),
                          collection_date: $('#collection_date').val(),
                          paid_date: $('#paid_date').val(),
                          paid_balance: $('#paid_balance').val(),
                          station: $('#station').val(),
                    },
                    success: function (json) {
                      display_success('Saved Successfully')                
                    },
                    error: function (xhr, errmsg, err) {
                      display_errors('Error processing AJAX')
                    }
                  });
              }      

              });  
      });    
    </script>    
{% endblock %}